name: Deployment-Portfolio
on:
  push:
    branches: 
      - main    
jobs:
  Deploy-Frontend-ssh:
    runs-on: ubuntu-latest
    steps:
      - name: publish frontend app
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          password: ${{ secrets.PASSWORD }}
          port: ${{ secrets.PORT }}
          command_timeout: 30m
          script: | 
            cd /var/www/portfolio
            git pull

            #Elimino la versi√≥n anterior
            sudo rm -f /etc/nginx/sites-enabled/arielgrillo.es /etc/nginx/sites-available/arielgrillo.es
            
            #Sobreescribo el existente
            sudo cp -f /var/www/portfolio/frontend/Deploy/portfolio_fe.config /etc/nginx/sites-available/portfolio_fe.config
            
            #Crear el symlink
            sudo rm -f /etc/nginx/sites-enabled/portfolio_fe.config
            sudo ln -sfn /etc/nginx/sites-available/portfolio_fe.config /etc/nginx/sites-enabled/portfolio_fe.config
                        
            sudo nginx -t
            sudo systemctl reload nginx
